<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />

  <!-- Versão da aplicação para controle de cache -->
  <meta name="app-version" content="%APP_VERSION%" />
  <meta name="build-time" content="%BUILD_TIME%" />

  <!-- Cache Control - Previne cache agressivo do navegador -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>FisioFlow - Sistema de Gestão para Clínicas de Fisioterapia</title>
  <meta name="description"
    content="Sistema completo de gestão para clínicas de fisioterapia com dashboard, agendamentos, pacientes e relatórios" />
  <meta name="author" content="FisioFlow" />
  <meta name="keywords" content="fisioterapia, clínica, gestão, agendamento, pacientes, sistema médico" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">

  <!-- PWA Configuration -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0ea5e9" />
  <meta name="background-color" content="#ffffff" />
  <meta name="display" content="standalone" />
  <meta name="orientation" content="portrait" />

  <!-- PWA Configuration for Mobile -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="FisioFlow" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.avif" />

  <!-- Favicon (SVG for modern browsers, AVIF fallback for newer browsers) -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/avif" sizes="32x32" href="/favicon-32x32.avif" />
  <link rel="icon" type="image/avif" sizes="16x16" href="/favicon-16x16.avif" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="manifest" href="/site.webmanifest" />

  <meta property="og:title" content="FisioFlow - Sistema de Gestão para Clínicas de Fisioterapia" />
  <meta property="og:description"
    content="Sistema completo de gestão para clínicas de fisioterapia com dashboard, agendamentos, pacientes e relatórios" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.avif" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@lovable_dev" />
  <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.avif" />
</head>

<body>
  <div id="root">
    <style>
      #initial-loader {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background-color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      }
      .loader-icon {
        width: 64px;
        height: 64px;
        background-color: rgba(14, 165, 233, 0.1);
        border-radius: 16px;
        position: relative;
        margin-bottom: 24px;
      }
      .spinner {
        width: 32px;
        height: 32px;
        border: 2px solid #0ea5e9;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-top: -16px;
        margin-left: -16px;
      }
      .loader-text {
        color: #0f172a;
        font-weight: 500;
        margin-bottom: 8px;
        font-size: 1rem;
      }
      .loader-subtext {
        color: #64748b;
        font-size: 0.875rem;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .progress-bar {
        width: 100%;
        max-width: 320px;
        height: 4px;
        background-color: #f1f5f9;
        border-radius: 9999px;
        overflow: hidden;
        margin-top: 24px;
      }
      .progress-value {
        width: 60%;
        height: 100%;
        background-color: #0ea5e9;
        border-radius: 9999px;
        animation: loading-progress 2s ease-in-out infinite;
      }
      @keyframes loading-progress {
        0% { width: 20%; transform: translateX(-100%); }
        50% { width: 60%; transform: translateX(0); }
        100% { width: 20%; transform: translateX(400%); }
      }
      @media (prefers-color-scheme: dark) {
        #initial-loader { background-color: #020817; }
        .loader-text { color: #f8fafc; }
        .loader-subtext { color: #94a3b8; }
        .progress-bar { background-color: #1e293b; }
      }
    </style>
    <div id="initial-loader">
      <div class="loader-icon">
        <div class="spinner"></div>
      </div>
      <div class="loader-text" id="loader-joke">Carregando sistema...</div>
      <div class="loader-subtext">Preparando sua reabilitação digital</div>
      <div class="progress-bar">
        <div class="progress-value"></div>
      </div>
    </div>
  </div>
  <!-- Expor versão globalmente para cache busting -->
  <script>
    window.__APP_VERSION__ = "%APP_VERSION%";
    window.__BUILD_TIME__ = "%BUILD_TIME%";
    window.__CACHE_BUSTER__ = window.__BUILD_TIME__ || Date.now().toString();

    const jokes = [
      "Carregando... alongando a verdade um pouquinho.",
      "Resistência não é fútil, é fisioterapia!",
      "Trabalhando na sua postura... digo, no seu sistema.",
      "Aguarde, estamos fortalecendo os pixels.",
      "Quase lá! Só mais uma série de 10 segundos.",
      "Gelo ou calor? Enquanto você decide, nós carregamos.",
      "Inspirar... Expirar... Carregar...",
      "Mobilizando as articulações do banco de dados."
    ];
    
    let jokeIndex = 0;
    const jokeElement = document.getElementById('loader-joke');
    if (jokeElement) {
      jokeElement.innerText = jokes[0];
      setInterval(() => {
        jokeIndex = (jokeIndex + 1) % jokes.length;
        jokeElement.innerText = jokes[jokeIndex];
      }, 3000);
    }

    // Limpar storage se a versão mudar drasticamente (ex: após 24h)
    const lastVersion = localStorage.getItem('app_version');
    const currentVersion = window.__APP_VERSION__;

    if (lastVersion && lastVersion !== currentVersion) {
      console.log('[Cache] Versão alterada, limpando caches...');
      // Limpar caches que podem causar problemas
      sessionStorage.clear();
      // Não limpar localStorage completamente para preservar preferências
    }

    localStorage.setItem('app_version', currentVersion);
    localStorage.setItem('last_build_time', window.__BUILD_TIME__);
  </script>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>
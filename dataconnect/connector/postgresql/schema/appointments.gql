# Firebase Data Connect Schema: Appointments
# Schema para gestão de agendamentos no FisioFlow

"""
Tipo de agendamento/sessão
"""
type Appointment @table {
  """
  Identificador único do agendamento
  """
  id: UUID! @default(uuid_generate_v4())

  """
  ID do paciente
  """
  patient_id: UUID!

  """
  ID do fisioterapeuta/profissional
  """
  therapist_id: UUID!

  """
  Data do agendamento
  """
  date: Date!

  """
  Horário de início
  """
  start_time: Time!

  """
  Horário de término
  """
  end_time: Time!

  """
  Status do agendamento: agendado, confirmado, em_atendimento, concluido, cancelado, paciente_faltou
  """
  status: String! @default("agendado")

  """
  Tipo de sessão: individual, dupla, grupo
  """
  session_type: String! @default("individual")

  """
  Observações sobre o agendamento
  """
  notes: String?

  """
  Motivo do cancelamento (se aplicável)
  """
  cancellation_reason: String?

  """
  ID da organização/clínica
  """
  organization_id: UUID!

  """
  Data e hora de criação
  """
  created_at: DateTime! @default(now())

  """
  Data e hora da última atualização
  """
  updated_at: DateTime! @default(now())

  """
  Data e hora do cancelamento (se aplicável)
  """
  cancelled_at: DateTime?

  """
  ID do usuário que cancelou
  """
  cancelled_by: UUID?

  # Relações
  """
  Paciente do agendamento
  """
  patient: Patient @belongsTo

  """
  Profissional responsável
  """
  therapist: Profile @belongsTo

  """
  Pagamento associado ao agendamento
  """
  payment: Payment? @hasOne
}

"""
Input para criar agendamento
"""
input CreateAppointmentInput {
  """
  ID do paciente
  """
  patient_id: UUID!

  """
  ID do fisioterapeuta
  """
  therapist_id: UUID!

  """
  Data do agendamento
  """
  date: Date!

  """
  Horário de início
  """
  start_time: Time!

  """
  Horário de término
  """
  end_time: Time!

  """
  Tipo de sessão
  """
  session_type: String @default("individual")

  """
  Observações
  """
  notes: String?

  """
  ID da organização
  """
  organization_id: UUID!
}

"""
Input para atualizar agendamento
"""
input UpdateAppointmentInput {
  """
  Novo status
  """
  status: String?

  """
  Novas observações
  """
  notes: String?

  """
  Motivo do cancelamento
  """
  cancellation_reason: String?
}

"""
Resultado de verificação de conflito de horário
"""
type TimeConflictCheck {
  """
  Indica se há conflito
  """
  has_conflict: Boolean!

  """
  Lista de agendamentos conflitantes
  """
  conflicting_appointments: [Appointment!]!
}

# Extensões para queries
"""
Filtro para agendamentos
"""
input AppointmentFilterInput {
  """
  Filtrar por data
  """
  date: DateFilter

  """
  Filtrar por paciente
  """
  patient_id: UUID

  """
  Filtrar por terapeuta
  """
  therapist_id: UUID

  """
  Filtrar por status
  """
  status: String

  """
  Filtrar por organização
  """
  organization_id: UUID

  """
  Filtrar por período
  """
  date_from: Date?
  date_to: Date?
}
